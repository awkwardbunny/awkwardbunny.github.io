<!DOCTYPE html>
<html lang="en" prefix="og: http://ogp.me/ns# fb: https://www.facebook.com/2008/fbml">
<head>
    <title>BUUL Part 2: Design - Brian S. Hong</title>
    <!-- Using the latest rendering mode for IE -->
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">


    <link href="https://blog.hongs.me/favicon.ico" rel="icon">

<link rel="canonical" href="https://blog.hongs.me/buul-part-2-design.html">

        <meta name="author" content="Brian" />
        <meta name="description" content="Design of the JUUL vaporizer clone." />

        <meta property="og:site_name" content="Brian S. Hong" />
        <meta property="og:type" content="article"/>
        <meta property="og:title" content="BUUL Part 2: Design"/>
        <meta property="og:url" content="https://blog.hongs.me/buul-part-2-design.html"/>
        <meta property="og:description" content="Design of the JUUL vaporizer clone."/>
        <meta property="article:published_time" content="2019-03-16" />
            <meta property="article:section" content="Projects" />
            <meta property="article:author" content="Brian" />



    <!-- Bootstrap -->
        <link rel="stylesheet" href="https://blog.hongs.me/theme/css/bootstrap.min.css" type="text/css"/>
    <link href="https://blog.hongs.me/theme/css/font-awesome.min.css" rel="stylesheet">

    <link href="https://blog.hongs.me/theme/css/pygments/native.css" rel="stylesheet">
    <link rel="stylesheet" href="https://blog.hongs.me/theme/css/style.css" type="text/css"/>

        <link href="https://blog.hongs.me/feeds/all.atom.xml" type="application/atom+xml" rel="alternate"
              title="Brian S. Hong ATOM Feed"/>

        <link href="https://blog.hongs.me/feeds/projects.atom.xml" type="application/atom+xml" rel="alternate"
              title="Brian S. Hong Projects ATOM Feed"/>
</head>
<body>

<div class="navbar navbar-default navbar-fixed-top" role="navigation">
    <div class="container">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-ex1-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a href="https://blog.hongs.me/" class="navbar-brand">
Brian S. Hong            </a>
        </div>
        <div class="collapse navbar-collapse navbar-ex1-collapse">
            <ul class="nav navbar-nav">
                    <li><a href="/pages/about-me.html">About</a></li>
                    <li><a href="https://github.com/awkwardbunny">GitHub</a></li>
                    <li><a href="https://linkedin.com/in/brianshong">LinkedIn</a></li>
            </ul>
            <ul class="nav navbar-nav navbar-right">
            </ul>
        </div>
        <!-- /.navbar-collapse -->
    </div>
</div> <!-- /.navbar -->

<!-- Banner -->
<!-- End Banner -->

<!-- Content Container -->
<div class="container">
    <div class="row">
        <div class="col-lg-12">
    <section id="content">
        <article>
            <header class="page-header">
                <h1>
                    <a href="https://blog.hongs.me/buul-part-2-design.html"
                       rel="bookmark"
                       title="Permalink to BUUL Part 2: Design">
                        BUUL Part 2: Design
                    </a>
                </h1>
            </header>
            <div class="entry-content">
                <div class="panel">
                    <div class="panel-body">
<footer class="post-info">
    <span class="label label-default">Date</span>
    <span class="published">
        <i class="fa fa-calendar"></i><time datetime="2019-03-16T14:30:00-04:00"> Sat 16 March 2019</time>
    </span>





    
</footer><!-- /.post-info -->                    </div>
                </div>
                <p>This is the part two of my vaporizor writeup. You can find part one <a href="/buul-part-1-reversing-the-juul.html">here</a>.<br>
<strong>Note: THIS POST IS INCOMPLETE</strong></p>
<h2>Power Supply</h2>
<p>Now that I know the voltage and how much current it needs to be able to supply, I can start
designing the power supply. Since it needs to output a whopping 6 watts, I decided to go
with a switch mode power supply.</p>
<h3>Types of Voltage Regulators.</h3>
<p>Here, I'll discuss a few different types of voltage regulators.<br>
First, there are the linear regulators. They are often quick and easy to use, but can be
very inefficient, espcially for high loads. That is because they act like a voltage divider,
but with feedback and stuff. It's advantages are that it gives a low output ripple and noise.
It's bad for this case because it is highly inefficient, and to make this project portable,
it is going to run off a battery. When a linear regulator is used to lower the voltage, all
that extra power goes directly to heat. For example, If there is a 12 volt input to a 5 volt
regulator, and the load pulls 1 amps, it will draw 1 amp from the 12V supply and dissipate
that as heat. So in this example, it would be something like 7 watts per amp drawn.
(12V - 5V) * 1A  </p>
<p>On the other hand, switch mode power supplies tend to be more efficient. They work by
<em>switching</em> the output on and off really quickly and smoothing out the ripple with inductors
and capacitors, until you get the desired voltage. It is similar to how a PWM signal works to
"fake" an analog signal with a digital signals. In fact, I will be using a PWM signal to a
transistor to create a buck converter.  </p>
<p>Buck converters are a type of switch mode power supplies when the output voltage is lower than
that of the input. Boost converters are used to increase the voltage from a lower source.  </p>
<h3>The Microcontroller</h3>
<p>I needed a microcontroller of some sorts to basically control the vaporizer. A simple operation
would be that it has a button and the coil/power supply connected and would turn the power on
when the button is pressed. I was going to use a buck converter, so the microcontroller should
output the PWM. I did some quick search for cheap and small microcontrollers. I found and decided
to use the <a href="https://www.microchip.com/wwwproducts/en/ATtiny10">ATTINY10</a> of the AVR microcontroller
series. These things are tiny and consume very little power, also being perfect for small embedded
projects like this.  </p>
<p><img alt="ATTINY10 Pinout" src="https://blog.hongs.me/img/002_attiny_pinout.png"><br>
The above is the pinout diagram of the attiny10  microcontroller. There are two pins for power
(VCC and GND), and a whopping number of 4 GPIOs, which is more than enough. For the basic operation,
we only really need two I/Os, one for the button and another for the PWM output. The other two I/Os
can be reserved for extra functionality. I originally planned to have one for LED and the other
for voltage output feedback, to ensure that the voltage is actually what we want.  </p>
<p>Looking at some other features of the attiny10, it's got a programmable timer, two PWM channels,
4 8-bit ADCs.</p>
<h3>Designing a Buck Converter</h3>
<p>A basic buck converter looks and works like this:<br>
<img alt="Buck Converter Diagram" src="https://blog.hongs.me/img/002_buck_converter.png"><br>
As mentioned above, the output voltage can be changed or set by changing the duty cycle of the
on/off times of the switch. The on-off signal from the switch is then 'smoothed' out via the
LC filter. At first, I was looking to use a built-in switching regulator, but most of them
seemed to need external inductors anyways. And since I'm already using a MCU for the PWM and to
do other stuff as well, I decided to just build a buck converter.  </p>
<p>Texas Instruments had this document <a href="http://www.ti.com/lit/an/slva477b/slva477b.pdf">SLVA477B</a>
on designing the power stage of a buck converter, which was very useful. I just followed through
the calculations to get the desired output.</p>
<p><img alt="Buck Converter Power Stage" src="https://blog.hongs.me/img/002_buck_converter_sch.png"><br>
In my design, I replaced the switch with a transistor. I used an PFET instead of NFET since it
will be easier to drive it due to biasing (<a href="https://electronics.stackexchange.com/questions/194634/p-channel-vs-n-channel-in-buck-converter">stackexchange</a>).
To choose a transistor, I went on Digikey's parameteric search. I ended up with <a href="https://www.digikey.com/product-detail/en/diodes-incorporated/DMG2305UX-13/DMG2305UX-13DICT-ND/4251589">DMG2305UX</a>.
The most important parameters in this case I think were the threshhold voltage and the voltage+current rating.
The current has to be higher than 2 amps. This one can deal with 4.2 amps, to be safe.</p>
            </div>
            <!-- /.entry-content -->
        </article>
    </section>

        </div>
    </div>
</div>
<!-- End Content Container -->

<footer>
   <div class="container">
      <hr>
      <div class="row">
         <div class="col-xs-10">&copy; 2019 Brian
            &middot; Powered by <a href="https://github.com/getpelican/pelican-themes/tree/master/pelican-bootstrap3" target="_blank">pelican-bootstrap3</a>,
            <a href="http://docs.getpelican.com/" target="_blank">Pelican</a>,
            <a href="http://getbootstrap.com" target="_blank">Bootstrap</a>         </div>
         <div class="col-xs-2"><p class="pull-right"><i class="fa fa-arrow-up"></i> <a href="#">Back to top</a></p></div>
      </div>
   </div>
</footer>
<script src="https://blog.hongs.me/theme/js/jquery.min.js"></script>

<!-- Include all compiled plugins (below), or include individual files as needed -->
<script src="https://blog.hongs.me/theme/js/bootstrap.min.js"></script>

<!-- Enable responsive features in IE8 with Respond.js (https://github.com/scottjehl/Respond) -->
<script src="https://blog.hongs.me/theme/js/respond.min.js"></script>




</body>
</html>